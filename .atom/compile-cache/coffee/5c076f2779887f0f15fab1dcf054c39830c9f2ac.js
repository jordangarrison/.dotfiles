(function() {
  var Dom;

  Dom = require('./dom');

  module.exports = {
    init: function(state) {
      var self;
      self = this;
      this.themeSet = false;
      if (self.isLoaded('seti-syntax')) {
        atom.config.onDidChange('seti-syntax.themeColor', function(value) {
          return self.setTheme(value.newValue, value.oldValue, true);
        });
        atom.config.onDidChange('seti-syntax.dynamicColor', function(value) {
          var newColor;
          if (value.newValue) {
            newColor = atom.config.get('seti-ui.themeColor');
            return self.setTheme(newColor, false, true);
          } else {
            if (atom.config.get('seti-syntax.themeColor')) {
              newColor = atom.config.get('seti-syntax.themeColor');
            } else {
              newColor = 'default';
            }
            return self.setTheme(newColor, false, true);
          }
        });
        if (self.isLoaded('seti-ui')) {
          if (atom.config.get('seti-syntax.dynamicColor') && !this.themeSet) {
            self.setTheme(atom.config.get('seti-ui.themeColor'), false, false);
          }
          atom.config.onDidChange('seti-ui.themeColor', function(value) {
            if (atom.config.get('seti-syntax.dynamicColor')) {
              return self.setTheme(value.newValue, value.oldValue, false);
            }
          });
          self.onDeactivate('seti-ui', function() {
            if (atom.config.get('seti-syntax.dynamicColor')) {
              return self.setTheme('default', false, false);
            }
          });
        }
        if ((atom.config.get('seti-syntax.themeColor')) && !this.themeSet) {
          return self.setTheme(atom.config.get('seti-syntax.themeColor'), false, false);
        } else if (!this.themeSet) {
          return self.setTheme('default', false, false);
        }
      }
    },
    isLoaded: function(which) {
      return atom.packages.isPackageLoaded(which);
    },
    onActivate: function(which, cb) {
      return atom.packages.onDidActivatePackage(function(pkg) {
        if (pkg.name === which) {
          return cb(pkg);
        }
      });
    },
    onDeactivate: function(which, cb) {
      return atom.packages.onDidDeactivatePackage(function(pkg) {
        if (pkg.name === which) {
          return cb(pkg);
        }
      });
    },
    "package": atom.packages.getLoadedPackage('seti-syntax'),
    packageInfo: function(which) {
      return atom.packages.getLoadedPackage(which);
    },
    refresh: function() {
      var self;
      self = this;
      self["package"].deactivate();
      return setImmediate(function() {
        return self["package"].activate();
      });
    },
    setTheme: function(theme, previous, reload) {
      var fs, pkg, self, themeData;
      self = this;
      fs = require('fs');
      pkg = this["package"];
      themeData = '@import "themes/' + theme.toLowerCase() + '";';
      this.themeSet = true;
      return fs.readFile(pkg.path + '/styles/user-theme.less', 'utf8', function(err, fileData) {
        if (fileData !== themeData) {
          return fs.writeFile(pkg.path + '/styles/user-theme.less', themeData, function(err) {
            if (!err) {
              return self.refresh();
            }
          });
        }
      });
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvamdhcnJpc29uLy5hdG9tL3BhY2thZ2VzL3NleHktZGFyay10aGVtZS9saWIvc2V0dGluZ3MuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQTs7RUFBQSxHQUFBLEdBQU0sT0FBQSxDQUFRLE9BQVI7O0VBRU4sTUFBTSxDQUFDLE9BQVAsR0FDRTtJQUFBLElBQUEsRUFBTSxTQUFDLEtBQUQ7QUFFSixVQUFBO01BQUEsSUFBQSxHQUFPO01BQ1AsSUFBQyxDQUFBLFFBQUQsR0FBWTtNQUdaLElBQUcsSUFBSSxDQUFDLFFBQUwsQ0FBYyxhQUFkLENBQUg7UUFHRSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVosQ0FBd0Isd0JBQXhCLEVBQWtELFNBQUMsS0FBRDtpQkFDaEQsSUFBSSxDQUFDLFFBQUwsQ0FBYyxLQUFLLENBQUMsUUFBcEIsRUFBOEIsS0FBSyxDQUFDLFFBQXBDLEVBQThDLElBQTlDO1FBRGdELENBQWxEO1FBSUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFaLENBQXdCLDBCQUF4QixFQUFvRCxTQUFDLEtBQUQ7QUFFbEQsY0FBQTtVQUFBLElBQUksS0FBSyxDQUFDLFFBQVY7WUFDRSxRQUFBLEdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFaLENBQWdCLG9CQUFoQjttQkFDWCxJQUFJLENBQUMsUUFBTCxDQUFjLFFBQWQsRUFBd0IsS0FBeEIsRUFBK0IsSUFBL0IsRUFGRjtXQUFBLE1BQUE7WUFNRSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQix3QkFBaEIsQ0FBSjtjQUNFLFFBQUEsR0FBVyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQVosQ0FBZ0Isd0JBQWhCLEVBRGI7YUFBQSxNQUFBO2NBSUUsUUFBQSxHQUFXLFVBSmI7O21CQUtBLElBQUksQ0FBQyxRQUFMLENBQWMsUUFBZCxFQUF3QixLQUF4QixFQUErQixJQUEvQixFQVhGOztR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LFNBQUEsR0FBWSxrQkFBQSxHQUFxQixLQUFLLENBQUMsV0FBTixDQUFBLENBQXJCLEdBQTJDO01BR3ZELElBQUMsQ0FBQSxRQUFELEdBQVk7YUFHWixFQUFFLENBQUMsUUFBSCxDQUFZLEdBQUcsQ0FBQyxJQUFKLEdBQVcseUJBQXZCLEVBQWtELE1BQWxELEVBQTBELFNBQUMsR0FBRCxFQUFNLFFBQU47UUFFeEQsSUFBRyxRQUFBLEtBQVksU0FBZjtpQkFFRSxFQUFFLENBQUMsU0FBSCxDQUFhLEdBQUcsQ0FBQyxJQUFKLEdBQVcseUJBQXhCLEVBQW1ELFNBQW5ELEVBQThELFNBQUMsR0FBRDtZQUU1RCxJQUFHLENBQUMsR0FBSjtxQkFFRSxJQUFJLENBQUMsT0FBTCxDQUFBLEVBRkY7O1VBRjRELENBQTlELEVBRkY7O01BRndELENBQTFEO0lBVlEsQ0F4RlY7O0FBSEYiLCJzb3VyY2VzQ29udGVudCI6WyJEb20gPSByZXF1aXJlKCcuL2RvbScpXG5cbm1vZHVsZS5leHBvcnRzID1cbiAgaW5pdDogKHN0YXRlKSAtPlxuXG4gICAgc2VsZiA9IEBcbiAgICBAdGhlbWVTZXQgPSBmYWxzZVxuXG4gICAgIyBPTkNFIFBBQ0tBR0UgSVMgTE9BREVEXG4gICAgaWYgc2VsZi5pc0xvYWRlZCgnc2V0aS1zeW50YXgnKVxuXG4gICAgICAjIFdIRU4gU1lOVEFYIFRIRU1FIENIQU5HRVNcbiAgICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlICdzZXRpLXN5bnRheC50aGVtZUNvbG9yJywgKHZhbHVlKSAtPlxuICAgICAgICBzZWxmLnNldFRoZW1lIHZhbHVlLm5ld1ZhbHVlLCB2YWx1ZS5vbGRWYWx1ZSwgdHJ1ZVxuXG4gICAgICAjIFdIRU4gRFlOQU1JQyBUSEVNRSBJUyBFTkFCTEVEIE9SIERJU0FCTEVEXG4gICAgICBhdG9tLmNvbmZpZy5vbkRpZENoYW5nZSAnc2V0aS1zeW50YXguZHluYW1pY0NvbG9yJywgKHZhbHVlKSAtPlxuICAgICAgICAjIElGIERZTklNSUMgSVMgQUxMV09FRFxuICAgICAgICBpZiAodmFsdWUubmV3VmFsdWUpXG4gICAgICAgICAgbmV3Q29sb3IgPSBhdG9tLmNvbmZpZy5nZXQoJ3NldGktdWkudGhlbWVDb2xvcicpXG4gICAgICAgICAgc2VsZi5zZXRUaGVtZSBuZXdDb2xvciwgZmFsc2UsIHRydWVcbiAgICAgICAgIyBJRiBEWU5BTUlDIElTIE5PVCBBTExPV0VEXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAjIElGIFNZTlRBWCBDT0xPUiBIQVMgQkVFTiBTRVRcbiAgICAgICAgICBpZiAoYXRvbS5jb25maWcuZ2V0KCdzZXRpLXN5bnRheC50aGVtZUNvbG9yJykpXG4gICAgICAgICAgICBuZXdDb2xvciA9IGF0b20uY29uZmlnLmdldCgnc2V0aS1zeW50YXgudGhlbWVDb2xvcicpXG4gICAgICAgICAgIyBGQUxMQkFDSyBUUCBERUZBVUxUIENPTE8gSUYgTk9ORSBTRVRcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZXdDb2xvciA9ICdkZWZhdWx0J1xuICAgICAgICAgIHNlbGYuc2V0VGhlbWUgbmV3Q29sb3IsIGZhbHNlLCB0cnVlXG5cbiAgICAgICMgSUYgU0VUSSBVSSBJUyBMT0FERURcbiAgICAgIGlmIHNlbGYuaXNMb2FkZWQoJ3NldGktdWknKVxuXG4gICAgICAgICMgSUYgRFlOQU1JQyBUSEVNIElTIEFMTE9XRURcbiAgICAgICAgaWYgYXRvbS5jb25maWcuZ2V0KCdzZXRpLXN5bnRheC5keW5hbWljQ29sb3InKSBhbmQgbm90IEB0aGVtZVNldFxuICAgICAgICAgICMgU0VUIFNZTlRBWCBUSEVNRSBUTyBNQVRDSCBVSVxuICAgICAgICAgIHNlbGYuc2V0VGhlbWUgYXRvbS5jb25maWcuZ2V0KCdzZXRpLXVpLnRoZW1lQ29sb3InKSwgZmFsc2UsIGZhbHNlXG5cbiAgICAgICAgIyBXSEVOIFVJIFRIRU1FIENIQU5HRVNcbiAgICAgICAgYXRvbS5jb25maWcub25EaWRDaGFuZ2UgJ3NldGktdWkudGhlbWVDb2xvcicsICh2YWx1ZSkgLT5cbiAgICAgICAgICAjIElGIERZTkFNSUMgVEhFTSBJUyBBTExPV0VEXG4gICAgICAgICAgaWYgYXRvbS5jb25maWcuZ2V0KCdzZXRpLXN5bnRheC5keW5hbWljQ29sb3InKVxuICAgICAgICAgICAgIyBTRVQgU1lOVEFYIFRIRU1FIFRPIE1BVENIIFVJXG4gICAgICAgICAgICBzZWxmLnNldFRoZW1lIHZhbHVlLm5ld1ZhbHVlLCB2YWx1ZS5vbGRWYWx1ZSwgZmFsc2VcblxuICAgICAgICAjIElGIFNFVEkgVUkgSVMgREVBQ1RJVkFURURcbiAgICAgICAgc2VsZi5vbkRlYWN0aXZhdGUgJ3NldGktdWknLCAtPlxuICAgICAgICAgICMgSUYgRFlOQU1JQyBUSEVNIFdBUyBBTExPV0VEXG4gICAgICAgICAgaWYgYXRvbS5jb25maWcuZ2V0KCdzZXRpLXN5bnRheC5keW5hbWljQ29sb3InKVxuICAgICAgICAgICAgIyBTRVQgVEhFTUUgVE8gREVGQVVMVFxuICAgICAgICAgICAgc2VsZi5zZXRUaGVtZSAnZGVmYXVsdCcsIGZhbHNlLCBmYWxzZVxuXG4gICAgICAjIFNFVCBVU0VSIFRIRU1FIElTIE5PVCBTRVQgRFlOQU1JQ0FMTFlcbiAgICAgIGlmIChhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LnRoZW1lQ29sb3InKSkgYW5kIG5vdCBAdGhlbWVTZXRcbiAgICAgICAgc2VsZi5zZXRUaGVtZSBhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LnRoZW1lQ29sb3InKSwgZmFsc2UsIGZhbHNlXG5cbiAgICAgICMgSUYgQUxMIEVMU0UgSEFTIEZBSUxFRCwgTE9BRCBUSEUgREVGQVVMVCBUSEVNRVxuICAgICAgZWxzZSBpZiAobm90IEB0aGVtZVNldClcbiAgICAgICAgc2VsZi5zZXRUaGVtZSAnZGVmYXVsdCcsIGZhbHNlLCBmYWxzZVxuXG4gICMgQ0hFQ0tTIElGIEEgUEFDS0FHRSBJUyBMT0FERURcbiAgaXNMb2FkZWQ6ICh3aGljaCkgLT5cbiAgICByZXR1cm4gYXRvbS5wYWNrYWdlcy5pc1BhY2thZ2VMb2FkZWQod2hpY2gpXG5cbiAgIyBXSEVOIFBBQ0tBR0UgQUNUSVZBVEVTXG4gIG9uQWN0aXZhdGU6ICh3aGljaCwgY2IpIC0+XG4gICAgYXRvbS5wYWNrYWdlcy5vbkRpZEFjdGl2YXRlUGFja2FnZSAocGtnKSAtPlxuICAgICAgaWYgcGtnLm5hbWUgPT0gd2hpY2hcbiAgICAgICAgY2IgcGtnXG5cbiAgIyBXSEVOIFBBQ0tBR0UgREVBQ1RJVkFURVNcbiAgb25EZWFjdGl2YXRlOiAod2hpY2gsIGNiKSAtPlxuICAgIGF0b20ucGFja2FnZXMub25EaWREZWFjdGl2YXRlUGFja2FnZSAocGtnKSAtPlxuICAgICAgaWYgcGtnLm5hbWUgPT0gd2hpY2hcbiAgICAgICAgY2IgcGtnXG5cbiAgIyBHRVQgSU5GTyBBQk9VVCBPVVIgUEFDS0FHRVxuICBwYWNrYWdlOiBhdG9tLnBhY2thZ2VzLmdldExvYWRlZFBhY2thZ2UoJ3NldGktc3ludGF4JylcblxuICAjIERFVEVSTUlORSBJRiBBIFNQRUNJRklDIFBBQ0tBR0UgSEFTIEJFRU4gTE9BREVEXG4gIHBhY2thZ2VJbmZvOiAod2hpY2gpIC0+XG4gICAgcmV0dXJuIGF0b20ucGFja2FnZXMuZ2V0TG9hZGVkUGFja2FnZSB3aGljaFxuXG4gICMgUkVMT0FEIFdIRU4gU0VUVElOR1MgQ0hBTkdFXG4gIHJlZnJlc2g6IC0+XG4gICAgc2VsZiA9IEBcbiAgICBzZWxmLnBhY2thZ2UuZGVhY3RpdmF0ZSgpXG4gICAgc2V0SW1tZWRpYXRlIC0+XG4gICAgICByZXR1cm4gc2VsZi5wYWNrYWdlLmFjdGl2YXRlKClcblxuICBzZXRUaGVtZTogKHRoZW1lLCBwcmV2aW91cywgcmVsb2FkKSAtPlxuICAgIHNlbGYgPSBAXG4gICAgZnMgPSByZXF1aXJlKCdmcycpXG4gICAgcGtnID0gQHBhY2thZ2VcbiAgICB0aGVtZURhdGEgPSAnQGltcG9ydCBcInRoZW1lcy8nICsgdGhlbWUudG9Mb3dlckNhc2UoKSArICdcIjsnXG5cbiAgICAjIFRISVMgUFJFVkVOVFMgVEhFTUUgRlJPTSBCRUlORyBTRVQgVFdJQ0VcbiAgICBAdGhlbWVTZXQgPSB0cnVlXG5cbiAgICAjIENIRUNLIENVUlJFTlQgVEhFTUUgRklMRVxuICAgIGZzLnJlYWRGaWxlIHBrZy5wYXRoICsgJy9zdHlsZXMvdXNlci10aGVtZS5sZXNzJywgJ3V0ZjgnLCAoZXJyLCBmaWxlRGF0YSkgLT5cbiAgICAgICMgSUYgVEhFTUUgSVMgRElGRkVSRU5UIFRIQU4gSVMgVVNFRCBUTyBCRVxuICAgICAgaWYgZmlsZURhdGEgIT0gdGhlbWVEYXRhXG4gICAgICAgICMgU0FWRSBBIE5FVyBVU0VSIFRIRU1FIEZJTEVcbiAgICAgICAgZnMud3JpdGVGaWxlIHBrZy5wYXRoICsgJy9zdHlsZXMvdXNlci10aGVtZS5sZXNzJywgdGhlbWVEYXRhLCAoZXJyKSAtPlxuICAgICAgICAgICMgSUYgRklMRSBXQVMgV1JJVFRFTiBPS1xuICAgICAgICAgIGlmICFlcnJcbiAgICAgICAgICAgICMgUkVMT0FEIFRIRSBWSUVXXG4gICAgICAgICAgICBzZWxmLnJlZnJlc2goKVxuIl19
