function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _specHelpers = require('./spec-helpers');

var _specHelpers2 = _interopRequireDefault(_specHelpers);

describe('OpenerRegistry', function () {
  var filePath = 'wibble.pdf';
  // The various viewers
  var cannotOpen = undefined,
      canOpen = undefined,
      canOpenInBackground = undefined,
      canOpenWithSynctex = undefined;

  beforeEach(function () {
    waitsForPromise(function () {
      return _specHelpers2['default'].activatePackages();
    });
  });

  function createOpener(name, canOpen, hasSynctex, canOpenInBackground) {
    var instance = jasmine.createSpyObj(name, ['canOpen', 'open', 'hasSynctex', 'canOpenInBackground']);
    instance.canOpen.andReturn(canOpen);
    instance.open.andCallFake(function () {
      return Promise.resolve(undefined);
    });
    instance.hasSynctex.andReturn(hasSynctex);
    instance.canOpenInBackground.andReturn(canOpenInBackground);
    latex.opener.openers.set(name, instance);
    return instance;
  }

  beforeEach(function () {
    latex.opener.openers.clear();
    // The opener names have to conform to latex.opener schema
    cannotOpen = createOpener('skim', false, true, true);
    canOpen = createOpener('xdg-open', true, false, false);
    canOpenInBackground = createOpener('okular', true, false, true);
    canOpenWithSynctex = createOpener('evince', true, true, false);
  });

  describe('open', function () {
    it('opens using preferred viewer even if it does not have requested features', function () {
      atom.config.set('latex.enableSynctex', true);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'xdg-open');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).toHaveBeenCalled();
        expect(canOpenInBackground.open).not.toHaveBeenCalled();
        expect(canOpenWithSynctex.open).not.toHaveBeenCalled();
      });
    });

    it('opens viewer that supports SyncTeX when enabled', function () {
      atom.config.set('latex.enableSynctex', true);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'automatic');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).not.toHaveBeenCalled();
        expect(canOpenInBackground.open).not.toHaveBeenCalled();
        expect(canOpenWithSynctex.open).toHaveBeenCalled();
      });
    });

    it('opens viewer that supports background opening when enabled', function () {
      atom.config.set('latex.enableSynctex', false);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'automatic');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).not.toHaveBeenCalled();
        expect(canOpenInBackground.open).toHaveBeenCalled();
        expect(canOpenWithSynctex.open).not.toHaveBeenCalled();
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2pnYXJyaXNvbi8uYXRvbS9wYWNrYWdlcy9sYXRleC9zcGVjL29wZW5lci1yZWdpc3RyeS1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7MkJBRW9CLGdCQUFnQjs7OztBQUVwQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsWUFBTTtBQUMvQixNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUE7O0FBRTdCLE1BQUksVUFBVSxZQUFBO01BQUUsT0FBTyxZQUFBO01BQUUsbUJBQW1CLFlBQUE7TUFBRSxrQkFBa0IsWUFBQSxDQUFBOztBQUVoRSxZQUFVLENBQUMsWUFBTTtBQUNmLG1CQUFlLENBQUMsWUFBTTtBQUNwQixhQUFPLHlCQUFRLGdCQUFnQixFQUFFLENBQUE7S0FDbEMsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLFdBQVMsWUFBWSxDQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLG1CQUFtQixFQUFFO0FBQ3JFLFFBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUscUJBQXFCLENBQUMsQ0FBQyxDQUFBO0FBQ3JHLFlBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ25DLFlBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQU0sT0FBTyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7S0FBQSxDQUFDLENBQUE7QUFDM0QsWUFBUSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUE7QUFDekMsWUFBUSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO0FBQzNELFNBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFDeEMsV0FBTyxRQUFRLENBQUE7R0FDaEI7O0FBRUQsWUFBVSxDQUFDLFlBQU07QUFDZixTQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQTs7QUFFNUIsY0FBVSxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUNwRCxXQUFPLEdBQUcsWUFBWSxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ3RELHVCQUFtQixHQUFHLFlBQVksQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUMvRCxzQkFBa0IsR0FBRyxZQUFZLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7R0FDL0QsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyxNQUFNLEVBQUUsWUFBTTtBQUNyQixNQUFFLENBQUMsMEVBQTBFLEVBQUUsWUFBTTtBQUNuRixVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUM1QyxVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUNyRCxVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLENBQUE7O0FBRTNDLHFCQUFlLENBQUM7ZUFBTSxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7T0FBQSxDQUFDLENBQUE7O0FBRWxELFVBQUksQ0FBQyxZQUFNO0FBQ1QsY0FBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUM5QyxjQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDdkMsY0FBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO0FBQ3ZELGNBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtPQUN2RCxDQUFDLENBQUE7S0FDSCxDQUFDLENBQUE7O0FBRUYsTUFBRSxDQUFDLGlEQUFpRCxFQUFFLFlBQU07QUFDMUQsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDNUMsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsOEJBQThCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDckQsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFBOztBQUU1QyxxQkFBZSxDQUFDO2VBQU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO09BQUEsQ0FBQyxDQUFBOztBQUVsRCxVQUFJLENBQUMsWUFBTTtBQUNULGNBQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDOUMsY0FBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUMzQyxjQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDdkQsY0FBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUE7T0FDbkQsQ0FBQyxDQUFBO0tBQ0gsQ0FBQyxDQUFBOztBQUVGLE1BQUUsQ0FBQyw0REFBNEQsRUFBRSxZQUFNO0FBQ3JFLFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQzdDLFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLDhCQUE4QixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3JELFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQTs7QUFFNUMscUJBQWUsQ0FBQztlQUFNLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztPQUFBLENBQUMsQ0FBQTs7QUFFbEQsVUFBSSxDQUFDLFlBQU07QUFDVCxjQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO0FBQzlDLGNBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDM0MsY0FBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDbkQsY0FBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO09BQ3ZELENBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvaG9tZS9qZ2Fycmlzb24vLmF0b20vcGFja2FnZXMvbGF0ZXgvc3BlYy9vcGVuZXItcmVnaXN0cnktc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAYmFiZWwgKi9cblxuaW1wb3J0IGhlbHBlcnMgZnJvbSAnLi9zcGVjLWhlbHBlcnMnXG5cbmRlc2NyaWJlKCdPcGVuZXJSZWdpc3RyeScsICgpID0+IHtcbiAgY29uc3QgZmlsZVBhdGggPSAnd2liYmxlLnBkZidcbiAgLy8gVGhlIHZhcmlvdXMgdmlld2Vyc1xuICBsZXQgY2Fubm90T3BlbiwgY2FuT3BlbiwgY2FuT3BlbkluQmFja2dyb3VuZCwgY2FuT3BlbldpdGhTeW5jdGV4XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IHtcbiAgICAgIHJldHVybiBoZWxwZXJzLmFjdGl2YXRlUGFja2FnZXMoKVxuICAgIH0pXG4gIH0pXG5cbiAgZnVuY3Rpb24gY3JlYXRlT3BlbmVyIChuYW1lLCBjYW5PcGVuLCBoYXNTeW5jdGV4LCBjYW5PcGVuSW5CYWNrZ3JvdW5kKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaihuYW1lLCBbJ2Nhbk9wZW4nLCAnb3BlbicsICdoYXNTeW5jdGV4JywgJ2Nhbk9wZW5JbkJhY2tncm91bmQnXSlcbiAgICBpbnN0YW5jZS5jYW5PcGVuLmFuZFJldHVybihjYW5PcGVuKVxuICAgIGluc3RhbmNlLm9wZW4uYW5kQ2FsbEZha2UoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCkpXG4gICAgaW5zdGFuY2UuaGFzU3luY3RleC5hbmRSZXR1cm4oaGFzU3luY3RleClcbiAgICBpbnN0YW5jZS5jYW5PcGVuSW5CYWNrZ3JvdW5kLmFuZFJldHVybihjYW5PcGVuSW5CYWNrZ3JvdW5kKVxuICAgIGxhdGV4Lm9wZW5lci5vcGVuZXJzLnNldChuYW1lLCBpbnN0YW5jZSlcbiAgICByZXR1cm4gaW5zdGFuY2VcbiAgfVxuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGxhdGV4Lm9wZW5lci5vcGVuZXJzLmNsZWFyKClcbiAgICAvLyBUaGUgb3BlbmVyIG5hbWVzIGhhdmUgdG8gY29uZm9ybSB0byBsYXRleC5vcGVuZXIgc2NoZW1hXG4gICAgY2Fubm90T3BlbiA9IGNyZWF0ZU9wZW5lcignc2tpbScsIGZhbHNlLCB0cnVlLCB0cnVlKVxuICAgIGNhbk9wZW4gPSBjcmVhdGVPcGVuZXIoJ3hkZy1vcGVuJywgdHJ1ZSwgZmFsc2UsIGZhbHNlKVxuICAgIGNhbk9wZW5JbkJhY2tncm91bmQgPSBjcmVhdGVPcGVuZXIoJ29rdWxhcicsIHRydWUsIGZhbHNlLCB0cnVlKVxuICAgIGNhbk9wZW5XaXRoU3luY3RleCA9IGNyZWF0ZU9wZW5lcignZXZpbmNlJywgdHJ1ZSwgdHJ1ZSwgZmFsc2UpXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ29wZW4nLCAoKSA9PiB7XG4gICAgaXQoJ29wZW5zIHVzaW5nIHByZWZlcnJlZCB2aWV3ZXIgZXZlbiBpZiBpdCBkb2VzIG5vdCBoYXZlIHJlcXVlc3RlZCBmZWF0dXJlcycsICgpID0+IHtcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXguZW5hYmxlU3luY3RleCcsIHRydWUpXG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4Lm9wZW5SZXN1bHRJbkJhY2tncm91bmQnLCB0cnVlKVxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC5vcGVuZXInLCAneGRnLW9wZW4nKVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gbGF0ZXgub3BlbmVyLm9wZW4oZmlsZVBhdGgpKVxuXG4gICAgICBydW5zKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KGNhbm5vdE9wZW4ub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3Blbi5vcGVuKS50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW5JbkJhY2tncm91bmQub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3BlbldpdGhTeW5jdGV4Lm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGl0KCdvcGVucyB2aWV3ZXIgdGhhdCBzdXBwb3J0cyBTeW5jVGVYIHdoZW4gZW5hYmxlZCcsICgpID0+IHtcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXguZW5hYmxlU3luY3RleCcsIHRydWUpXG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4Lm9wZW5SZXN1bHRJbkJhY2tncm91bmQnLCB0cnVlKVxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC5vcGVuZXInLCAnYXV0b21hdGljJylcblxuICAgICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IGxhdGV4Lm9wZW5lci5vcGVuKGZpbGVQYXRoKSlcblxuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIGV4cGVjdChjYW5ub3RPcGVuLm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW4ub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3BlbkluQmFja2dyb3VuZC5vcGVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuV2l0aFN5bmN0ZXgub3BlbikudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpdCgnb3BlbnMgdmlld2VyIHRoYXQgc3VwcG9ydHMgYmFja2dyb3VuZCBvcGVuaW5nIHdoZW4gZW5hYmxlZCcsICgpID0+IHtcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXguZW5hYmxlU3luY3RleCcsIGZhbHNlKVxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC5vcGVuUmVzdWx0SW5CYWNrZ3JvdW5kJywgdHJ1ZSlcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXgub3BlbmVyJywgJ2F1dG9tYXRpYycpXG5cbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBsYXRleC5vcGVuZXIub3BlbihmaWxlUGF0aCkpXG5cbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICBleHBlY3QoY2Fubm90T3Blbi5vcGVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuLm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW5JbkJhY2tncm91bmQub3BlbikudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuV2l0aFN5bmN0ZXgub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==