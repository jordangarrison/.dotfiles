/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

!function(){var e,r,t;!function(n){function s(e,r){return y.call(e,r)}function o(e,r){var t,n,s,o,i,a,c,u,f,l,b,d,g=r&&r.split("/"),m=h.map,p=m&&m["*"]||{};if(e){for(e=e.split("/"),i=e.length-1,h.nodeIdCompat&&x.test(e[i])&&(e[i]=e[i].replace(x,"")),"."===e[0].charAt(0)&&g&&(d=g.slice(0,g.length-1),e=d.concat(e)),f=0;f<e.length;f++)if(b=e[f],"."===b)e.splice(f,1),f-=1;else if(".."===b){if(0===f||1===f&&".."===e[2]||".."===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}if((g||p)&&m){for(t=e.split("/"),f=t.length;f>0;f-=1){if(n=t.slice(0,f).join("/"),g)for(l=g.length;l>0;l-=1)if(s=m[g.slice(0,l).join("/")],s&&(s=s[n])){o=s,a=f;break}if(o)break;!c&&p&&p[n]&&(c=p[n],u=f)}!o&&c&&(o=c,a=u),o&&(t.splice(0,a,o),e=t.join("/"))}return e}function i(e,r){return function(){var t=L.call(arguments,0);return"string"!=typeof t[0]&&1===t.length&&t.push(null),g.apply(n,t.concat([e,r]))}}function a(e){return function(r){return o(r,e)}}function c(e){return function(r){w[e]=r}}function u(e){if(s(v,e)){var r=v[e];delete v[e],M[e]=!0,d.apply(n,r)}if(!s(w,e)&&!s(M,e))throw new Error("No "+e);return w[e]}function f(e){var r,t=e?e.indexOf("!"):-1;return t>-1&&(r=e.substring(0,t),e=e.substring(t+1,e.length)),[r,e]}function l(e){return e?f(e):[]}function b(e){return function(){return h&&h.config&&h.config[e]||{}}}var d,g,m,p,w={},v={},h={},M={},y=Object.prototype.hasOwnProperty,L=[].slice,x=/\.js$/;m=function(e,r){var t,n=f(e),s=n[0],i=r[1];return e=n[1],s&&(s=o(s,i),t=u(s)),s?e=t&&t.normalize?t.normalize(e,a(i)):o(e,i):(e=o(e,i),n=f(e),s=n[0],e=n[1],s&&(t=u(s))),{f:s?s+"!"+e:e,n:e,pr:s,p:t}},p={require:function(e){return i(e)},exports:function(e){var r=w[e];return"undefined"!=typeof r?r:w[e]={}},module:function(e){return{id:e,uri:"",exports:w[e],config:b(e)}}},d=function(e,r,t,o){var a,f,b,d,g,h,y,L=[],x=typeof t;if(o=o||e,h=l(o),"undefined"===x||"function"===x){for(r=!r.length&&t.length?["require","exports","module"]:r,g=0;g<r.length;g+=1)if(d=m(r[g],h),f=d.f,"require"===f)L[g]=p.require(e);else if("exports"===f)L[g]=p.exports(e),y=!0;else if("module"===f)a=L[g]=p.module(e);else if(s(w,f)||s(v,f)||s(M,f))L[g]=u(f);else{if(!d.p)throw new Error(e+" missing "+f);d.p.load(d.n,i(o,!0),c(f),{}),L[g]=w[f]}b=t?t.apply(w[e],L):void 0,e&&(a&&a.exports!==n&&a.exports!==w[e]?w[e]=a.exports:b===n&&y||(w[e]=b))}else e&&(w[e]=t)},e=r=g=function(e,r,t,s,o){if("string"==typeof e)return p[e]?p[e](r):u(m(e,l(r)).f);if(!e.splice){if(h=e,h.deps&&g(h.deps,h.callback),!r)return;r.splice?(e=r,r=t,t=null):e=n}return r=r||function(){},"function"==typeof t&&(t=s,s=o),s?d(n,e,r,t):setTimeout(function(){d(n,e,r,t)},4),g},g.config=function(e){return g(e)},e._defined=w,t=function(e,r,t){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");r.splice||(t=r,r=[]),s(w,e)||s(v,e)||(v[e]=[e,r,t])},t.amd={jQuery:!0}}(),t("js/vendor/almond.js",function(){}),t("api",[],function(){"use strict";function e(){var e={getURL:browser.runtime.getURL,runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,r,t){browser.storage.local.get(e,function(e){browser.runtime.lastError?t():r(e)})},set:function(e,r,t){browser.storage.local.set(e,function(){browser.runtime.lastError?t():r()})}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,r,t){browser.tabs.get(e,function(e){browser.runtime.lastError?t():r(e)})},query:function(e,r,t){browser.tabs.query(e,function(e){browser.runtime.lastError?t():r(e)})},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}function r(){var e={getURL:chrome.runtime.getURL,runtime:{sendMessage:chrome.runtime.sendMessage,addOnMessageListener:function(e){chrome.runtime.onMessage.addListener(e)}},storage:{get:function(e,r,t){chrome.storage.local.get(e,function(e){chrome.runtime.lastError?t():r(e)})},set:function(e,r,t){chrome.storage.local.set(e,function(){chrome.runtime.lastError?t():r()})}},i18nMessage:chrome.i18n.getMessage};return void 0!==chrome.tabs&&(e.version=chrome.runtime.getManifest().version,e.tabs={get:function(e,r,t){chrome.tabs.get(e,function(e){chrome.runtime.lastError?t():r(e)})},query:function(e,r,t){chrome.tabs.query(e,function(e){chrome.runtime.lastError?t():r(e)})},create:chrome.tabs.create,remove:chrome.tabs.remove,sendMessage:chrome.tabs.sendMessage,addOnActivatedListener:function(e){chrome.tabs.onActivated.addListener(e)}},e.action={enable:chrome.browserAction.enable,disable:chrome.browserAction.disable}),e}function t(){var e={getURL:function(e){return browser.runtime.getURL(e)},runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,r,t){browser.storage.local.get(e).then(r,t)},set:function(e,r,t){browser.storage.local.set(e).then(r,t)}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,r,t){browser.tabs.get(e).then(r,t)},query:function(e,r,t){browser.tabs.query(e).then(r,t)},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}var n,s=navigator.userAgent.toLowerCase();return n=s.toLowerCase().indexOf("edge")!==-1?e():s.indexOf("chrome")!==-1?r():t()}),t("server",["require","api"],function(e){"use strict";var r=e("api"),t=r.getURL("");return{base:t,url:"https://gmail-extension.cleanfox.io",api:"https://gmail-extension.cleanfox.io/api"}}),r(["server","api"],function(e,r){"use strict";r.storage.get("version",function(e){var t=r.version;r.storage.set({version:t},function(){void 0===e.version?r.tabs.create({url:"https://mail.google.com"}):t!==e.version})}),r.tabs.addOnActivatedListener(function(t){r.action.disable(),r.tabs.get(t.tabId,function(n){n.url.startsWith("https://mail.google.com/")?(r.tabs.sendMessage(t.tabId,{type:"reload"}),r.action.enable()):n.url.startsWith(e.url)?r.action.enable():n.url.startsWith(e.base)&&r.action.enable()})}),r.runtime.addOnMessageListener(function(e){switch(e.type){case"open":r.tabs.query({active:!0},function(t){r.tabs.create({url:e.url,index:t[0].index})});break;case"close":r.tabs.query({active:!0,currentWindow:!0},function(e){r.tabs.remove(e[0].id)});break;case"click":switch(e.value){case"connect":r.tabs.query({active:!0,currentWindow:!0},function(t){r.tabs.create({url:e.url,index:t[0].index})});break;case"retry":r.tabs.query({active:!0,currentWindow:!0},function(t){r.tabs.sendMessage(t[0].id,e)})}}})}),t("app",function(){})}();