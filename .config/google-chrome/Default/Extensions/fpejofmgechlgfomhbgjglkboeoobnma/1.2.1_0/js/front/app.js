/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

!function(){var e,t,n;!function(r){function o(e,t){return x.call(e,t)}function i(e,t){var n,r,o,i,s,c,u,a,l,f,d,p,h=t&&t.split("/"),g=w.map,m=g&&g["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,w.nodeIdCompat&&E.test(e[s])&&(e[s]=e[s].replace(E,"")),"."===e[0].charAt(0)&&h&&(p=h.slice(0,h.length-1),e=p.concat(e)),l=0;l<e.length;l++)if(d=e[l],"."===d)e.splice(l,1),l-=1;else if(".."===d){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((h||m)&&g){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),h)for(f=h.length;f>0;f-=1)if(o=g[h.slice(0,f).join("/")],o&&(o=o[r])){i=o,c=l;break}if(i)break;!u&&m&&m[r]&&(u=m[r],a=l)}!i&&u&&(i=u,c=a),i&&(n.splice(0,c,i),e=n.join("/"))}return e}function s(e,t){return function(){var n=M.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(r,n.concat([e,t]))}}function c(e){return function(t){return i(t,e)}}function u(e){return function(t){v[e]=t}}function a(e){if(o(b,e)){var t=b[e];delete b[e],y[e]=!0,p.apply(r,t)}if(!o(v,e)&&!o(y,e))throw new Error("No "+e);return v[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function f(e){return e?l(e):[]}function d(e){return function(){return w&&w.config&&w.config[e]||{}}}var p,h,g,m,v={},b={},w={},y={},x=Object.prototype.hasOwnProperty,M=[].slice,E=/\.js$/;g=function(e,t){var n,r=l(e),o=r[0],s=t[1];return e=r[1],o&&(o=i(o,s),n=a(o)),o?e=n&&n.normalize?n.normalize(e,c(s)):i(e,s):(e=i(e,s),r=l(e),o=r[0],e=r[1],o&&(n=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return s(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},p=function(e,t,n,i){var c,l,d,p,h,w,x,M=[],E=typeof n;if(i=i||e,w=f(i),"undefined"===E||"function"===E){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(p=g(t[h],w),l=p.f,"require"===l)M[h]=m.require(e);else if("exports"===l)M[h]=m.exports(e),x=!0;else if("module"===l)c=M[h]=m.module(e);else if(o(v,l)||o(b,l)||o(y,l))M[h]=a(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,s(i,!0),u(l),{}),M[h]=v[l]}d=n?n.apply(v[e],M):void 0,e&&(c&&c.exports!==r&&c.exports!==v[e]?v[e]=c.exports:d===r&&x||(v[e]=d))}else e&&(v[e]=n)},e=t=h=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):a(g(e,f(t)).f);if(!e.splice){if(w=e,w.deps&&h(w.deps,w.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),h},h.config=function(e){return h(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(v,e)||o(b,e)||(b[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("js/vendor/almond.js",function(){}),function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof n&&n.amd?n("mustache",["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return g(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}function i(e,t){return m.call(e,t)}function s(e){return!i(v,e)}function c(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return b[e]})}function u(t,n){function o(){if(v&&!b)for(;m.length;)delete h[m.pop()];else m=[];v=!1,b=!1}function i(e){if("string"==typeof e&&(e=e.split(y,2)),!g(e)||2!==e.length)throw new Error("Invalid tags: "+e);c=new RegExp(r(e[0])+"\\s*"),u=new RegExp("\\s*"+r(e[1])),d=new RegExp("\\s*"+r("}"+e[1]))}if(!t)return[];var c,u,d,p=[],h=[],m=[],v=!1,b=!1;i(n||e.tags);for(var k,S,_,A,L,q,T=new f(t);!T.eos();){if(k=T.pos,_=T.scanUntil(c))for(var C=0,U=_.length;C<U;++C)A=_.charAt(C),s(A)?m.push(h.length):b=!0,h.push(["text",A,k,k+1]),k+=1,"\n"===A&&o();if(!T.scan(c))break;if(v=!0,S=T.scan(E)||"name",T.scan(w),"="===S?(_=T.scanUntil(x),T.scan(x),T.scanUntil(u)):"{"===S?(_=T.scanUntil(d),T.scan(M),T.scanUntil(u),S="&"):_=T.scanUntil(u),!T.scan(u))throw new Error("Unclosed tag at "+T.pos);if(L=[S,_,k,T.pos],h.push(L),"#"===S||"^"===S)p.push(L);else if("/"===S){if(q=p.pop(),!q)throw new Error('Unopened section "'+_+'" at '+k);if(q[1]!==_)throw new Error('Unclosed section "'+q[1]+'" at '+k)}else"name"===S||"{"===S||"&"===S?b=!0:"="===S&&i(_)}if(q=p.pop())throw new Error('Unclosed section "'+q[1]+'" at '+T.pos);return l(a(h))}function a(e){for(var t,n,r=[],o=0,i=e.length;o<i;++o)t=e[o],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function l(e){for(var t,n,r=[],o=r,i=[],s=0,c=e.length;s<c;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),i.push(t),o=t[4]=[];break;case"/":n=i.pop(),n[5]=t[2],o=i.length>0?i[i.length-1][4]:r;break;default:o.push(t)}return r}function f(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function p(){this.cache={}}var h=Object.prototype.toString,g=Array.isArray||function(e){return"[object Array]"===h.call(e)},m=RegExp.prototype.test,v=/\S/,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},w=/\s*/,y=/\s+/,x=/\s*=/,M=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},f.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var n,r=this.cache;if(r.hasOwnProperty(e))n=r[e];else{for(var i,s,c=this,u=!1;c;){if(e.indexOf(".")>0)for(n=c.view,i=e.split("."),s=0;null!=n&&s<i.length;)s===i.length-1&&(u=o(n,i[s])),n=n[i[s++]];else n=c.view[e],u=o(c.view,e);if(u)break;c=c.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=u(e,t)),r},p.prototype.render=function(e,t,n){var r=this.parse(e),o=t instanceof d?t:new d(t);return this.renderTokens(r,o,n,e)},p.prototype.renderTokens=function(e,t,n,r){for(var o,i,s,c="",u=0,a=e.length;u<a;++u)s=void 0,o=e[u],i=o[0],"#"===i?s=this.renderSection(o,t,n,r):"^"===i?s=this.renderInverted(o,t,n,r):">"===i?s=this.renderPartial(o,t,n,r):"&"===i?s=this.unescapedValue(o,t):"name"===i?s=this.escapedValue(o,t):"text"===i&&(s=this.rawValue(o)),void 0!==s&&(c+=s);return c},p.prototype.renderSection=function(e,n,r,o){function i(e){return s.render(e,n,r)}var s=this,c="",u=n.lookup(e[1]);if(u){if(g(u))for(var a=0,l=u.length;a<l;++a)c+=this.renderTokens(e[4],n.push(u[a]),r,o);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)c+=this.renderTokens(e[4],n.push(u),r,o);else if(t(u)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");u=u.call(n.view,o.slice(e[3],e[5]),i),null!=u&&(c+=u)}else c+=this.renderTokens(e[4],n,r,o);return c}},p.prototype.renderInverted=function(e,t,n,r){var o=t.lookup(e[1]);if(!o||g(o)&&0===o.length)return this.renderTokens(e[4],t,n,r)},p.prototype.renderPartial=function(e,n,r){if(r){var o=t(r)?r(e[1]):r[e[1]];return null!=o?this.renderTokens(this.parse(o),n,r,o):void 0}},p.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},p.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},p.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var k=new p;return e.clearCache=function(){return k.clearCache()},e.parse=function(e,t){return k.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return k.render(e,t,r)},e.to_html=function(n,r,o,i){var s=e.render(n,r,o);return t(i)?void i(s):s},e.escape=c,e.Scanner=f,e.Context=d,e.Writer=p,e}),n("api",[],function(){"use strict";function e(){var e={getURL:browser.runtime.getURL,runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,t,n){browser.storage.local.get(e,function(e){browser.runtime.lastError?n():t(e)})},set:function(e,t,n){browser.storage.local.set(e,function(){browser.runtime.lastError?n():t()})}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,t,n){browser.tabs.get(e,function(e){browser.runtime.lastError?n():t(e)})},query:function(e,t,n){browser.tabs.query(e,function(e){browser.runtime.lastError?n():t(e)})},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}function t(){var e={getURL:chrome.runtime.getURL,runtime:{sendMessage:chrome.runtime.sendMessage,addOnMessageListener:function(e){chrome.runtime.onMessage.addListener(e)}},storage:{get:function(e,t,n){chrome.storage.local.get(e,function(e){chrome.runtime.lastError?n():t(e)})},set:function(e,t,n){chrome.storage.local.set(e,function(){chrome.runtime.lastError?n():t()})}},i18nMessage:chrome.i18n.getMessage};return void 0!==chrome.tabs&&(e.version=chrome.runtime.getManifest().version,e.tabs={get:function(e,t,n){chrome.tabs.get(e,function(e){chrome.runtime.lastError?n():t(e)})},query:function(e,t,n){chrome.tabs.query(e,function(e){chrome.runtime.lastError?n():t(e)})},create:chrome.tabs.create,remove:chrome.tabs.remove,sendMessage:chrome.tabs.sendMessage,addOnActivatedListener:function(e){chrome.tabs.onActivated.addListener(e)}},e.action={enable:chrome.browserAction.enable,disable:chrome.browserAction.disable}),e}function n(){var e={getURL:function(e){return browser.runtime.getURL(e)},runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,t,n){browser.storage.local.get(e).then(t,n)},set:function(e,t,n){browser.storage.local.set(e).then(t,n)}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,t,n){browser.tabs.get(e).then(t,n)},query:function(e,t,n){browser.tabs.query(e).then(t,n)},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}var r,o=navigator.userAgent.toLowerCase();return r=o.toLowerCase().indexOf("edge")!==-1?e():o.indexOf("chrome")!==-1?t():n()}),n("server",["require","api"],function(e){"use strict";var t=e("api"),n=t.getURL("");return{base:n,url:"https://gmail-extension.cleanfox.io",api:"https://gmail-extension.cleanfox.io/api"}}),n("backend",["require","server","api"],function(e){"use strict";function t(e){return new Promise(function(t,n){u.storage.get("tokens",function(r){if(void 0!==r.tokens){var o=r.tokens[e];if(void 0!==o)return void t(o)}n(null)})})}function n(e,n){return new Promise(function(r,o){t(e).then(function(e){s(c.api+"/expeditor/"+n+"/stats","json",e).then(function(e){if(0===e.data.mails.total)r({email:e.data.email});else{var t=e.data.mails.openRate,n=e.data.mails.total.toString(),o=e.data.mails.rating.split("/");r({email:e.data.email,rate:u.i18nMessage("openRate",t.toString()),co2:u.i18nMessage("co2",e.data.mails.co2.toFixed(2)),count:u.i18nMessage("emails",n),unsubscribe:u.i18nMessage("unsubscribe"),delete:u.i18nMessage("delete",n),filter:u.i18nMessage("filter",n),rating:100*parseInt(o[0])/parseInt(o[1]),starPicture:u.getURL("img/leaf.png"),ratingText:u.i18nMessage("rating"),color:t<40?"bad_open_rate":t<75?"middle_open_rate":"good_open_rate"})}}).catch(function(t){o(t>401||e)})}).catch(function(e){o(e)})})}function r(e,n){return new Promise(function(r,o){t(e).then(function(e){s(c.api+"/expeditor/"+n+"/unsubscribe","json",e).then(function(e){r(e)}).catch(function(t){o(t>401||e)})}).catch(function(e){o(e)})})}function o(e,n){return new Promise(function(r,o){t(e).then(function(e){s(c.api+"/expeditor/"+n+"/deleteall","json",e).then(function(e){r(e)}).catch(function(t){o(t>401||e)})}).catch(function(e){o(e)})})}function i(e,n){return new Promise(function(r,o){t(e).then(function(e){s(c.api+"/expeditor/"+n+"/autofilter","json",e).then(function(e){r(e)}).catch(function(t){o(t>401||e)})}).catch(function(e){o(e)})})}function s(e,t,n){return new Promise(function(r,o){var i=new Headers;void 0!==n&&i.append("x-access-token",n),fetch(e,{method:"get",headers:i}).then(function(e){if(!e.ok)throw{status:e.status};e[t]().then(function(e){r(e)})}).catch(function(e){o(e.status)})})}var c=e("server"),u=e("api");return{ajax:s,checkToken:t,stats:n,unsubscribe:r,delete:o,filter:i}}),n("front",["require","mustache","server","backend","api"],function(e){"use strict";function t(){var e=document.querySelector(R);void 0!==e&&null!==e&&e.css("position","unset")}function n(e){var t=e,n=null,r=this.str=function(){return null===n?t:t+"..."+n};return this.length=function(){return r().length},this.reduce=function(){null===n?(n=t.substr(t.length/2+1),t=t.substr(0,t.length/2)):t.length>n.length?t=t.substr(0,t.length-1):n=n.substr(1)},this}function r(e){return new Promise(function(t){var r=e.split("@"),i=new n(r[0]),s=r[1].lastIndexOf("."),c=new n(r[1].substr(0,s)),u=r[1].substr(s+1);o(t,e,209,i,c,u,5)})}function o(e,t,n,r,i,s,c){y("ellipsis.htm").then(function(u){document.body.append(q.to_html(u,{from:r.str(),at:i.str(),ext:s}));var a=document.querySelector("#cleanfox_temp"),l=a.clientWidth;if(a.remove(),l>n)r.length()>c?r.reduce():i.reduce(),o(e,t,n,r,i,s,c);else{var f=r.str()+"@"+i.str()+"."+s;e({min:f!==t&&f,full:t})}})}function i(){return void 0===B&&(B=Array.prototype.slice.call(document.querySelectorAll(".TK .aim a")).filter(function(e){return e.attr("href").endsWith("#trash")})[0].html()),B}function s(e){e.css("color","white").css("fontWeight","bold"),e.parentNode.parentNode.parentNode.css("background-color","#00aaf7"),setTimeout(function(){e.css("color","").css("fontWeight",""),e.parentNode.parentNode.parentNode.css("background-color","")},2e3)}function c(){var e=new MouseEvent("mousedown"),t=new MouseEvent("mouseup"),n=document.querySelector("div.T-I.J-J5-Ji.nu.T-I-ax7.L3");n.dispatchEvent(e),n.dispatchEvent(t)}function u(e,t){b(C.i18nMessage("unsubscribeAlert",t),function(){T.unsubscribe(e,t).then(function(){}).catch(function(n){n===!0?x(function(){u(e,t)}):E(e)})})}function a(e,t){b(C.i18nMessage("deleteAlert",t),function(){T.delete(e,t).then(function(){c();var e=i(),t=document.querySelector(".hN[name$='^i']"),n=t.html();t.attr("name","^k"),t.attr("title",t.attr("title").replace(n,e)),t.html(e);var r=document.querySelector(".hO[name$='^i']");r.attr("name","^k"),r.attr("title",r.attr("title").replace(n,e))}).catch(function(n){n===!0?x(function(){a(e,t)}):E(e)})})}function l(e,t){b(C.i18nMessage("filterAlert",t),function(){T.filter(e,t).then(function(){c(),setTimeout(function(){Array.prototype.slice.call(document.querySelectorAll(j)).forEach(function(e){e.attr("title")===t&&s(e)})},1e3)}).catch(function(n){n===!0?x(function(){l(e,t)}):E(e)})})}function f(e,t){return document.querySelector(e+"[id$='"+t+"']")}function d(e,t){return Array.from(document.querySelectorAll(e+"[class$='"+t+"']"))}function p(e){return e.target.className.split(" ").reduce(function(e,t){return e.indexOf("@")!==-1?e:t.indexOf("@")!==-1?t:""})}function h(){var e=f("div","cleanfox");null!==e&&e.remove()}function g(){A=0,null!==N&&(document.querySelector(".vh").empty(),clearTimeout(N),L(),L=null,N=null)}function m(){null!==N&&(clearTimeout(N),A=0,L=null,N=null,document.querySelector(".vh").empty(),document.querySelector(".b8.UC").css("position","relative").css("top","-10000px"))}function v(e){0===A?L():(A--,y("alert.htm").then(function(t){document.querySelector(".vh").empty().append(q.to_html(t,{message:e,cancel:C.i18nMessage("cancel",A.toString())})),document.querySelector("#cleanfox_cancel").event("click",function(){m()}),N=setTimeout(function(){v(e)},1e3)}))}function b(e,t){g(),document.querySelector(".b8.UC").css("position","unset").css("top",""),L=function(){N=null,document.querySelector(".b8.UC").css("position","relative").css("top","-10000px"),t()},A=5,v(e)}function w(){P=Array.prototype.slice.call(document.querySelectorAll(".inboxsdk__compose")).map(function(e){return e.id})}function y(e){return new Promise(function(t){T.ajax(C.getURL("templates/"+e),"text").then(function(e){"string"!=typeof e&&(e=(new XMLSerializer).serializeToString(e.documentElement)),t(e)})})}function x(e){t(),y("error.htm").then(function(t){h(),document.querySelector(U).prepend(q.to_html(t,{picture:C.getURL("img/google.png"),error:C.i18nMessage("error"),reload:C.i18nMessage("errorReload")})),document.querySelector("#cleanfox_reload").event("click",function(){e()})})}function M(){return t(),new Promise(function(e){var t=document.querySelector(U);document.querySelector(O).css("position",""),y("loading.htm").then(function(n){h(),t.prepend(q.to_html(n,{loading:C.i18nMessage("loading")})),e()})})}function E(e){t(),y("signin.htm").then(function(t){h(),document.querySelector(U).prepend(q.to_html(t,{picture:C.getURL("img/google.png"),needConnection:C.i18nMessage("needConnection",e),signIn:C.i18nMessage("signIn")})),I=!0,f("div","cleanfox_signin").event("click",function(){I?(I=!1,f("span","cleanfox_signin_text").html(C.i18nMessage("retry")),C.runtime.sendMessage({type:"click",value:"connect",url:C.i18nMessage("loginUrl")})):C.runtime.sendMessage({type:"click",value:"retry"})})})}function k(e,n,o){t(),Promise.all(o.map(function(e){return new Promise(function(t){r(e.email).then(function(n){e.email=n,t(e)})})})).then(function(t){r(n.email).then(function(r){n.email=r,y("cleanfox.htm").then(function(r){h(),document.querySelector(U).prepend(q.to_html(r,{data:n,more:t,debug:!1,noStats:C.i18nMessage("noStats"),help:C.i18nMessage("help"),helpUrl:C.i18nMessage("helpUrl"),feedback:C.i18nMessage("feedback"),feedbackUrl:C.i18nMessage("feedbackUrl"),cleanfox:"Go to Cleanfox",url:"https://www.cleanfox.io?utm_source=chrome_extension&utm_campaign=chrome_extension&utm_medium=chrome_extension"})),d("div","cleanfox_unsubscribe").forEach(function(t){t.event("click",function(t){var n=p(t);u(e,n)})}),d("div","cleanfox_delete").forEach(function(t){t.event("click",function(t){var n=p(t);a(e,n)})}),d("div","cleanfox_filter").forEach(function(t){t.event("click",function(t){var n=p(t);l(e,n)})})})})})}function S(){y("tutorial.htm").then(function(e){C.storage.get("signature",function(t){h(),document.body.append(q.to_html(e,{close:C.getURL("img/ic_close.png"),google:C.getURL("img/google.png"),congrat:C.i18nMessage("tutoTitle"),appInstalled:C.i18nMessage("tutoSubTitle"),tuto1:C.i18nMessage("tutoMessage1"),tuto2:C.i18nMessage("tutoMessage2"),tuto3:C.i18nMessage("tutoMessage3"),signature:C.i18nMessage("optionsSignature"),checked:void 0===t.signature||t.signature})),f("input","cleanfox_tutorial_signature").event("change",function(){C.storage.set({signature:this.checked},function(){})}),f("img","cleanfox_tutorial_close").event("click",function(){C.storage.set({tutorial:!0},function(){}),f("div","cleanfox_tutorial").remove()})})})}function _(){var e=C.i18nMessage("signatureQuote"),t="https://www.cleanfox.io?utm_source=chrome_extension&utm_campaign=chrome_extension&utm_medium=signature",n=Array.from(document.querySelectorAll(".editable"));Array.prototype.forEach.call(document.querySelectorAll('div[class$="cleanfox_sign"]'),function(e){n[n.indexOf(e.closest(".editable"))]=null});var r=n.reduce(function(e,t){return null!==t&&e.push(t),e},[]);0!==r.length&&y("signature.htm").then(function(n){r.forEach(function(r){var o=r.closest(".inboxsdk__compose").attr("id");P.indexOf(o)===-1&&(P.push(o),r.append(q.to_html(n,{url:t,quote:e})))})})}var A,L,q=e("mustache"),T=(e("server"),e("backend")),C=e("api"),U=".y3",O=".y3 > .nH",j=".ajl.aib.aZ6 .zw .TK .aim a",R=".nH.bno.adC",I=!0,P=[],N=null,B=void 0;return{clear:h,clearAlert:g,cleanSignatureIds:w,refresh:c,putError:x,putLoading:M,putSignIn:E,putCleanfox:k,putSignature:_,putTutorial:S}}),n("polyfill",[],function(){"use strict";function e(e){var t=document.createElement("div");return t.html(e),t.firstChild}return window.Element&&(Element.prototype.closest||(Element.prototype.closest=function(e){var t,n=(this.document||this.ownerDocument).querySelectorAll(e),r=this;do for(t=n.length;--t>=0&&n.item(t)!==r;);while(t<0&&(r=r.parentElement));return r}),Element.prototype.append=function(t){return this.appendChild(t instanceof Node?t:e(String(t))),this},Element.prototype.prepend=function(t){return this.childNodes.length>0?this.insertBefore(t instanceof Node?t:e(String(t)),this.firstChild):this.appendChild(t instanceof Node?t:e(String(t))),this},Element.prototype.remove=function(){this.parentNode.removeChild(this)},Element.prototype.html=function(e){return void 0===e?this.innerHTML:(this.innerHTML=e,this)},Element.prototype.attr=function(e,t){return void 0===t?this.getAttribute(e):(this.setAttribute(e,t),this)},Element.prototype.prop=function(e,t){return void 0===t?this[e]:(this[e]=t,this)},Element.prototype.empty=function(){for(;null!==this.firstChild;)this.removeChild(this.firstChild);return this},Element.prototype.css=function(e,t){var n=e.split("-").reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()});return void 0===t?this.style[n]:(this.style[n]=t,this)},Element.prototype.event=function(e,t){if(void 0!==t)return this["on"+e]=t,this;if(this.fireEvent)this.fireEvent("on"+e);else{var n=document.createEvent("Events");n.initEvent(e,!0,!1),this.dispatchEvent(n)}}),{}}),t(["front","backend","server","api","polyfill"],function(e,t,n,r){"use strict";function o(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0}function i(){var e=f[10];return null===e||void 0===e?null:e}function s(e){return Array.prototype.reduce.call(document.querySelectorAll(".gD"),function(t,n){var r=n.attr("email");return null!==r&&r!==e&&t.indexOf(r)===-1&&t.push(r),t},[])}function c(n,r){t.checkToken(n).then(function(){Promise.all(r.map(function(e){return t.stats(n,e)})).then(function(t){var o=r.sort(),i=!s(n).sort().some(function(e,t){return o[t]!==e});i&&e.putCleanfox(n,t.pop(),t)}).catch(function(t){"boolean"==typeof t&&t===!0?e.putError(function(){e.clear(),a()}):e.putSignIn(n)})}).catch(function(){e.putSignIn(n)})}function u(t){h=0;var i=window.location.href;if(e.clearAlert(),i.startsWith(n.url))if(i.indexOf("/ok.html?")!==-1){var s=document.createElement("button").html(r.i18nMessage("cta_close")).prop("disabled",!0).event("click",function(){r.runtime.sendMessage({type:"close"})}),c=(document.getElementById("main").append(s).css("text-align","center"),o("token")),u=o("email");r.storage.get("tokens",function(e){var t=e.tokens||{};t[u]=c,Object.keys(t).forEach(function(e){"null"===e&&delete t[e]}),r.storage.set({tokens:t},function(){s.prop("disabled",!1)})})}else 0===document.referrer.indexOf("https://accounts.google.com/signin/oauth/consent?authuser=")&&r.storage.set({error:!0},function(){r.runtime.sendMessage({type:"close"})});else{if(void 0!==window.top.getBrowser){var a=window.top.getBrowser().selectedBrowser.contentWindow;"undefined"!=typeof a.wrappedJSObject.ACCEPT_STATS&&(f="undefined"!=typeof GLOBALS?GLOBALS:"undefined"!=typeof window.opener.GLOBALS?window.opener.GLOBALS:[],l(t,i))}else{var d=document.createElement("script");d.src=r.getURL("js/gmail.js"),(document.head||document.documentElement).appendChild(d),d.parentNode.removeChild(d)}window.addEventListener("CleanfoxEvent",function e(n){window.removeEventListener("CleanfoxEvent",e),f=n.detail.passback,l(t,i)})}}function a(){r.storage.get("error",function(t){var n=t.error;n?r.storage.set({error:!1},function(){e.putError(function(){e.clear(),a()})}):setTimeout(function(){var t=i();if(null===t)return void setTimeout(function(){a()},500);var n=s(t);return 0===n.length?void(h<2&&setTimeout(function(){a()},500)):(p=n,void(0!==n.length&&null===document.querySelector("div[id$='cleanfox']")&&(document.querySelector("div.nH.bno.adC").css("height","100%").css("overflow-y","auto"),e.putLoading().then(function(){c(t,n)}))))},1e3)})}function l(t,n){if(n=n.substr(n.lastIndexOf("/")+1),n.startsWith("#"))d="";else{var r=new RegExp("([^?&#]*)").exec(n)[0];(t||d!==r)&&(d=r,e.clear(),a())}}var f=[],d="",p=[],h=0;r.storage.get("tutorial",function(t){t.tutorial||e.putTutorial()}),window.addEventListener("hashchange",function(){u(!1)}),window.addEventListener("click",function(){e.cleanSignatureIds(),r.storage.get("signature",function(t){(void 0===t.signature||t.signature)&&setTimeout(function(){e.putSignature()},500)});var t=s(i());if(t.length>0){var n=t.filter(function(e){return p.indexOf(e)===-1});n.length>0&&(e.clear(),a())}}),r.runtime.addOnMessageListener(function(t){switch(t.type){case"click":switch(t.value){case"retry":e.clear(),a()}break;case"reload":u(!0)}}),u(!1)}),n("app",function(){})}();