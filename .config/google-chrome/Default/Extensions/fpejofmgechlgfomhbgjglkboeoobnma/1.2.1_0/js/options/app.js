/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

!function(){var e,t,n;!function(r){function o(e,t){return E.call(e,t)}function i(e,t){var n,r,o,i,s,a,c,u,l,f,p,h,g=t&&t.split("/"),d=w.map,m=d&&d["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,w.nodeIdCompat&&M.test(e[s])&&(e[s]=e[s].replace(M,"")),"."===e[0].charAt(0)&&g&&(h=g.slice(0,g.length-1),e=h.concat(e)),l=0;l<e.length;l++)if(p=e[l],"."===p)e.splice(l,1),l-=1;else if(".."===p){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((g||m)&&d){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),g)for(f=g.length;f>0;f-=1)if(o=d[g.slice(0,f).join("/")],o&&(o=o[r])){i=o,a=l;break}if(i)break;!c&&m&&m[r]&&(c=m[r],u=l)}!i&&c&&(i=c,a=u),i&&(n.splice(0,a,i),e=n.join("/"))}return e}function s(e,t){return function(){var n=k.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),g.apply(r,n.concat([e,t]))}}function a(e){return function(t){return i(t,e)}}function c(e){return function(t){b[e]=t}}function u(e){if(o(v,e)){var t=v[e];delete v[e],y[e]=!0,h.apply(r,t)}if(!o(b,e)&&!o(y,e))throw new Error("No "+e);return b[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function f(e){return e?l(e):[]}function p(e){return function(){return w&&w.config&&w.config[e]||{}}}var h,g,d,m,b={},v={},w={},y={},E=Object.prototype.hasOwnProperty,k=[].slice,M=/\.js$/;d=function(e,t){var n,r=l(e),o=r[0],s=t[1];return e=r[1],o&&(o=i(o,s),n=u(o)),o?e=n&&n.normalize?n.normalize(e,a(s)):i(e,s):(e=i(e,s),r=l(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return s(e)},exports:function(e){var t=b[e];return"undefined"!=typeof t?t:b[e]={}},module:function(e){return{id:e,uri:"",exports:b[e],config:p(e)}}},h=function(e,t,n,i){var a,l,p,h,g,w,E,k=[],M=typeof n;if(i=i||e,w=f(i),"undefined"===M||"function"===M){for(t=!t.length&&n.length?["require","exports","module"]:t,g=0;g<t.length;g+=1)if(h=d(t[g],w),l=h.f,"require"===l)k[g]=m.require(e);else if("exports"===l)k[g]=m.exports(e),E=!0;else if("module"===l)a=k[g]=m.module(e);else if(o(b,l)||o(v,l)||o(y,l))k[g]=u(l);else{if(!h.p)throw new Error(e+" missing "+l);h.p.load(h.n,s(i,!0),c(l),{}),k[g]=b[l]}p=n?n.apply(b[e],k):void 0,e&&(a&&a.exports!==r&&a.exports!==b[e]?b[e]=a.exports:p===r&&E||(b[e]=p))}else e&&(b[e]=n)},e=t=g=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):u(d(e,f(t)).f);if(!e.splice){if(w=e,w.deps&&g(w.deps,w.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?h(r,e,t,n):setTimeout(function(){h(r,e,t,n)},4),g},g.config=function(e){return g(e)},e._defined=b,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(b,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("js/vendor/almond.js",function(){}),function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof n&&n.amd?n("mustache",["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return d(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}function i(e,t){return m.call(e,t)}function s(e){return!i(b,e)}function a(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return v[e]})}function c(t,n){function o(){if(b&&!v)for(;m.length;)delete g[m.pop()];else m=[];b=!1,v=!1}function i(e){if("string"==typeof e&&(e=e.split(y,2)),!d(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(r(e[0])+"\\s*"),c=new RegExp("\\s*"+r(e[1])),p=new RegExp("\\s*"+r("}"+e[1]))}if(!t)return[];var a,c,p,h=[],g=[],m=[],b=!1,v=!1;i(n||e.tags);for(var x,L,C,A,U,O,j=new f(t);!j.eos();){if(x=j.pos,C=j.scanUntil(a))for(var S=0,T=C.length;S<T;++S)A=C.charAt(S),s(A)?m.push(g.length):v=!0,g.push(["text",A,x,x+1]),x+=1,"\n"===A&&o();if(!j.scan(a))break;if(b=!0,L=j.scan(M)||"name",j.scan(w),"="===L?(C=j.scanUntil(E),j.scan(E),j.scanUntil(c)):"{"===L?(C=j.scanUntil(p),j.scan(k),j.scanUntil(c),L="&"):C=j.scanUntil(c),!j.scan(c))throw new Error("Unclosed tag at "+j.pos);if(U=[L,C,x,j.pos],g.push(U),"#"===L||"^"===L)h.push(U);else if("/"===L){if(O=h.pop(),!O)throw new Error('Unopened section "'+C+'" at '+x);if(O[1]!==C)throw new Error('Unclosed section "'+O[1]+'" at '+x)}else"name"===L||"{"===L||"&"===L?v=!0:"="===L&&i(C)}if(O=h.pop())throw new Error('Unclosed section "'+O[1]+'" at '+j.pos);return l(u(g))}function u(e){for(var t,n,r=[],o=0,i=e.length;o<i;++o)t=e[o],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function l(e){for(var t,n,r=[],o=r,i=[],s=0,a=e.length;s<a;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),i.push(t),o=t[4]=[];break;case"/":n=i.pop(),n[5]=t[2],o=i.length>0?i[i.length-1][4]:r;break;default:o.push(t)}return r}function f(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function h(){this.cache={}}var g=Object.prototype.toString,d=Array.isArray||function(e){return"[object Array]"===g.call(e)},m=RegExp.prototype.test,b=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},w=/\s*/,y=/\s+/,E=/\s*=/,k=/\s*\}/,M=/#|\^|\/|>|\{|&|=|!/;f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},f.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var n,r=this.cache;if(r.hasOwnProperty(e))n=r[e];else{for(var i,s,a=this,c=!1;a;){if(e.indexOf(".")>0)for(n=a.view,i=e.split("."),s=0;null!=n&&s<i.length;)s===i.length-1&&(c=o(n,i[s])),n=n[i[s++]];else n=a.view[e],c=o(a.view,e);if(c)break;a=a.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},h.prototype.clearCache=function(){this.cache={}},h.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=c(e,t)),r},h.prototype.render=function(e,t,n){var r=this.parse(e),o=t instanceof p?t:new p(t);return this.renderTokens(r,o,n,e)},h.prototype.renderTokens=function(e,t,n,r){for(var o,i,s,a="",c=0,u=e.length;c<u;++c)s=void 0,o=e[c],i=o[0],"#"===i?s=this.renderSection(o,t,n,r):"^"===i?s=this.renderInverted(o,t,n,r):">"===i?s=this.renderPartial(o,t,n,r):"&"===i?s=this.unescapedValue(o,t):"name"===i?s=this.escapedValue(o,t):"text"===i&&(s=this.rawValue(o)),void 0!==s&&(a+=s);return a},h.prototype.renderSection=function(e,n,r,o){function i(e){return s.render(e,n,r)}var s=this,a="",c=n.lookup(e[1]);if(c){if(d(c))for(var u=0,l=c.length;u<l;++u)a+=this.renderTokens(e[4],n.push(c[u]),r,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(e[4],n.push(c),r,o);else if(t(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(e[3],e[5]),i),null!=c&&(a+=c)}else a+=this.renderTokens(e[4],n,r,o);return a}},h.prototype.renderInverted=function(e,t,n,r){var o=t.lookup(e[1]);if(!o||d(o)&&0===o.length)return this.renderTokens(e[4],t,n,r)},h.prototype.renderPartial=function(e,n,r){if(r){var o=t(r)?r(e[1]):r[e[1]];return null!=o?this.renderTokens(this.parse(o),n,r,o):void 0}},h.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},h.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},h.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var x=new h;return e.clearCache=function(){return x.clearCache()},e.parse=function(e,t){return x.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return x.render(e,t,r)},e.to_html=function(n,r,o,i){var s=e.render(n,r,o);return t(i)?void i(s):s},e.escape=a,e.Scanner=f,e.Context=p,e.Writer=h,e}),n("api",[],function(){"use strict";function e(){var e={getURL:browser.runtime.getURL,runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,t,n){browser.storage.local.get(e,function(e){browser.runtime.lastError?n():t(e)})},set:function(e,t,n){browser.storage.local.set(e,function(){browser.runtime.lastError?n():t()})}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,t,n){browser.tabs.get(e,function(e){browser.runtime.lastError?n():t(e)})},query:function(e,t,n){browser.tabs.query(e,function(e){browser.runtime.lastError?n():t(e)})},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}function t(){var e={getURL:chrome.runtime.getURL,runtime:{sendMessage:chrome.runtime.sendMessage,addOnMessageListener:function(e){chrome.runtime.onMessage.addListener(e)}},storage:{get:function(e,t,n){chrome.storage.local.get(e,function(e){chrome.runtime.lastError?n():t(e)})},set:function(e,t,n){chrome.storage.local.set(e,function(){chrome.runtime.lastError?n():t()})}},i18nMessage:chrome.i18n.getMessage};return void 0!==chrome.tabs&&(e.version=chrome.runtime.getManifest().version,e.tabs={get:function(e,t,n){chrome.tabs.get(e,function(e){chrome.runtime.lastError?n():t(e)})},query:function(e,t,n){chrome.tabs.query(e,function(e){chrome.runtime.lastError?n():t(e)})},create:chrome.tabs.create,remove:chrome.tabs.remove,sendMessage:chrome.tabs.sendMessage,addOnActivatedListener:function(e){chrome.tabs.onActivated.addListener(e)}},e.action={enable:chrome.browserAction.enable,disable:chrome.browserAction.disable}),e}function n(){var e={getURL:function(e){return browser.runtime.getURL(e)},runtime:{sendMessage:browser.runtime.sendMessage,addOnMessageListener:browser.runtime.onMessage.addListener},storage:{get:function(e,t,n){browser.storage.local.get(e).then(t,n)},set:function(e,t,n){browser.storage.local.set(e).then(t,n)}},i18nMessage:browser.i18n.getMessage};return void 0!==browser.tabs&&(e.version=browser.runtime.getManifest().version,e.tabs={get:function(e,t,n){browser.tabs.get(e).then(t,n)},query:function(e,t,n){browser.tabs.query(e).then(t,n)},create:browser.tabs.create,remove:browser.tabs.remove,sendMessage:browser.tabs.sendMessage,addOnActivatedListener:browser.tabs.onActivated.addListener},e.action={enable:browser.browserAction.enable,disable:browser.browserAction.disable}),e}var r,o=navigator.userAgent.toLowerCase();return r=o.toLowerCase().indexOf("edge")!==-1?e():o.indexOf("chrome")!==-1?t():n()}),n("server",["require","api"],function(e){"use strict";var t=e("api"),n=t.getURL("");return{base:n,url:"https://gmail-extension.cleanfox.io",api:"https://gmail-extension.cleanfox.io/api"}}),n("polyfill",[],function(){"use strict";function e(e){var t=document.createElement("div");return t.html(e),t.firstChild}return window.Element&&(Element.prototype.closest||(Element.prototype.closest=function(e){var t,n=(this.document||this.ownerDocument).querySelectorAll(e),r=this;do for(t=n.length;--t>=0&&n.item(t)!==r;);while(t<0&&(r=r.parentElement));return r}),Element.prototype.append=function(t){return this.appendChild(t instanceof Node?t:e(String(t))),this},Element.prototype.prepend=function(t){return this.childNodes.length>0?this.insertBefore(t instanceof Node?t:e(String(t)),this.firstChild):this.appendChild(t instanceof Node?t:e(String(t))),this},Element.prototype.remove=function(){this.parentNode.removeChild(this)},Element.prototype.html=function(e){return void 0===e?this.innerHTML:(this.innerHTML=e,this)},Element.prototype.attr=function(e,t){return void 0===t?this.getAttribute(e):(this.setAttribute(e,t),this)},Element.prototype.prop=function(e,t){return void 0===t?this[e]:(this[e]=t,this)},Element.prototype.empty=function(){for(;null!==this.firstChild;)this.removeChild(this.firstChild);return this},Element.prototype.css=function(e,t){var n=e.split("-").reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()});return void 0===t?this.style[n]:(this.style[n]=t,this)},Element.prototype.event=function(e,t){if(void 0!==t)return this["on"+e]=t,this;if(this.fireEvent)this.fireEvent("on"+e);else{var n=document.createEvent("Events");n.initEvent(e,!0,!1),this.dispatchEvent(n)}}),{}}),t(["mustache","server","api","polyfill"],function(e,t,n,r){"use strict";function o(e){return new Promise(function(t){fetch(n.getURL("options/templates/options_"+e)).then(function(e){e.text().then(function(e){"string"!=typeof e&&(e=(new XMLSerializer).serializeToString(e.documentElement)),t(e)})})})}function i(e,t){delete e.tokens[t],n.storage.set({tokens:e.tokens},a)}function s(e,t){return e.target.className.split(" ").reduce(function(e,n){return e.indexOf(t)!==-1?n.indexOf(t)!==-1?null:n:e})}function a(){o("connect.htm").then(function(r){document.getElementById("cleanfox_reload").event("click",function(){a()}),n.storage.get("tokens",function(o){var a={title:n.i18nMessage("optionsConnectTitle"),logout:n.i18nMessage("optionsConnectLogout"),delete:n.i18nMessage("optionsConnectDelete"),or:n.i18nMessage("optionsConnectOr"),login:n.i18nMessage("optionsConnectLogin"),accounts:[]},c=o.tokens;void 0!==c&&(Object.keys(c).forEach(function(e){"null"===e&&delete c[e]}),n.storage.set({tokens:c},function(){}),a.accounts=Object.keys(c).map(function(e){return{email:e}})),document.getElementById("block-connect").html(e.to_html(r,a)),Array.prototype.forEach.call(document.getElementsByClassName("logout-link"),function(e){e.event("click",function(e){var t=s(e,"logout-link");n.storage.get("tokens",function(e){i(e,t)})})}),Array.prototype.forEach.call(document.getElementsByClassName("delete-link"),function(e){e.event("click",function(e){if(window.confirm(n.i18nMessage("optionsConnectDeleteAlert"))){var r=s(e,"delete-link");n.storage.get("tokens",function(e){var n=e.tokens[r];fetch(t.api+"/user/delete?token="+n),i(e,r)})}})}),document.getElementById("login-link").event("click",function(){n.tabs.query({active:!0},function(e){n.tabs.create({url:n.i18nMessage("loginUrl"),index:e[0].index})})})})}),o("signature.htm").then(function(t){n.storage.get("signature",function(r){document.getElementById("block-signature").html(e.to_html(t,{title:n.i18nMessage("optionsSignatureTitle"),signature:n.i18nMessage("optionsSignature"),checked:void 0===r.signature||r.signature})),document.getElementById("signature-checkbox").event("change",function(){n.storage.set({signature:this.checked},function(){})})})}),o("copyright.htm").then(function(t){document.getElementById("block-copyright").html(e.to_html(t,{cgu:n.i18nMessage("optionsCGU"),cguUrl:n.i18nMessage("optionsCGUUrl"),privacy:n.i18nMessage("optionsPrivacy"),privacyUrl:n.i18nMessage("optionsPrivacyUrl")}))})}n.tabs.addOnActivatedListener(function(e){n.tabs.get(e.tabId,function(e){e.url.startsWith(t.base)&&(a(),n.storage.get("error",function(e){e.error&&n.storage.set({error:!1},function(){alert(n.i18nMessage("error"))})}))})}),a(),n.storage.get("error",function(e){e.error&&n.storage.set({error:!1},function(){alert(n.i18nMessage("error"))})})}),n("app",function(){})}();